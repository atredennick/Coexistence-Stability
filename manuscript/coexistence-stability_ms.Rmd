---
layout: 12pt
header-includes:
  - \usepackage{lineno}
  - \linenumbers
  - \usepackage{setspace}
  - \usepackage{todonotes}
  - \doublespacing
  - \usepackage{rotating}
  - \usepackage{color, soul}
  - \usepackage[font={footnotesize},labelfont={sf,bf},labelsep=space]{caption}
  - \usepackage{sectsty}
bibliography: ~/Dropbox/Bibliography/CoexistStability.bib
csl: components/ecology.csl

## rmarkdown render options
output:
  pdf_document:
    fig_caption: true
    keep_tex: true
fontsize: 12pt
geometry: margin=1in
linkcolor: black
urlcolor: black
---

\renewcommand\linenumberfont{\normalfont\tiny\sffamily\color{gray}}

<!--
\allsectionsfont{\normalfont\sffamily\bfseries}
-->

\begin{singlespace}

\begin{centering}

\Large{How fluctuation-dependent species coexistence affects the diversity-stability relationship}



\vspace{2.5em}

\renewcommand*{\thefootnote}{\fnsymbol{footnote}}

\normalsize{Andrew T. Tredennick\textsuperscript{1}, Peter B. Adler\textsuperscript{1}, and Frederick R. Adler\textsuperscript{2}}

\vspace{1.5em}

\textit{\small{\textsuperscript{1}Department of Wildland Resources and the Ecology Center, Utah State University, Logan, Utah 84322}} \\
\textit{\small{\textsuperscript{2}Departments of Biology and Mathematics, University of Utah, Salt Lake City, Utah}} 

\end{centering}

\vspace{3em}

\noindent \textbf{Keywords}: coexistence, storage effect, relative nonlinearity, diversity-stability hypothesis, pulsed differential equation, consumer-resource dynamics

\noindent \textbf{Authorship}: All authors conceived the research and designed the modeling approach; ATT conducted model simulations, with input from PBA and FRA; ATT wrote the manuscript and all authors contributed to revisions.

\noindent \textbf{Running Title}: Environmental variability, ecosystem stability, \& species coexistence

\noindent \textbf{Article Type}: Letter

\noindent \textbf{Number of Words}:

\noindent \textbf{Number of References}:

\noindent \textbf{Number of Tables and Figures}:

\noindent \textbf{Corresponding Author}:  \\
Andrew Tredennick  \\
Department of Wildland Resources and the Ecology Center  \\
Utah State University  \\
5230 Old Main Hill  \\
Logan, Utah 84322 USA  \\
Phone: +1-970-443-1599  \\
Fax: +1-435-797-3796  \\
Email: atredenn@gmail.com

\end{singlespace}

```{r caching, include=FALSE}
library("methods")
library("knitr")
basename <- "manuscript"
opts_chunk$set(fig.path = paste("components/figure/", basename, "-", sep=""),
               cache.path = paste("components/cache/", basename, "/", sep=""))
opts_chunk$set(cache = 2)
opts_chunk$set(tidy=FALSE, warning=FALSE, message=FALSE, 
               comment = NA, verbose = TRUE, echo=FALSE)

# PDF-based figures
opts_chunk$set(dev='pdf')
```


```{r plot-options, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", 
               "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

opts_chunk$set(dev='pdf', dev.args=c(version="1.3"))

```

\newpage{}

\begin{abstract}
Theory relating species richness to ecosystem stability typically ignores the potential for environmental variability to promote species coexistence.
Failure to account for fluctuation-dependent coexistence mechanisms may explain observed deviations from the expected positive diversity-stability relationship, and limits our ability to predict the consequences of increasing environmental variability.
We use a consumer-resource model to explore how coexistence via the temporal storage effect and relative nonlinearity affects ecosystem stability.
We show that a negative, rather than positive, diversity-stability relationship is possible when ecosystem function is sampled across a natural gradient in environmental variability and diversity.
We also show how fluctuation-dependent coexistence can buffer ecosystem functioning against increasing environmental variability by allowing more species to coexist and contribute to portfolio effects.
Our work provides a general explanation for variation in observed diversity-stability relalationships and highlights the importance of conserving regional species pools to help buffer ecosystems against future increases in environmental variability.
\vspace{2em}
\end{abstract}


\newpage{}

\setlength{\parindent}{5ex}

INTRODUCTION
------------
@MacArthur1955, @Elton1958, and even Darwin [@Turnbull2013] recognized that species can compensate for each other and stabilize ecosystem functioning in fluctuating environments. 
This idea underlies the "insurance hypothesis" [@Yachi1999], which suggests stability increases with diversity because species respond dissimilarly to environmental conditions, broadening the range of conditions under which the community maintains function [@Loreau2010].
Diverse models all predict a positive relationship between species richness and ecosystem stability [@Lehman2000; @Ives2002b; @Loreau2013], and experimental tests tend to support such a prediction [@Tilman2006; @Hector2010].

However, the ability of biodiversity-ecosystem functioning (BEF) experiments to represent real-world dynamics is the subject of debate [@Wardle2016; @Eisenhauer2016].
Much of the debate centers around the fact that species losses in BEF experiments are not allowed to be offset by species gains.
Theoretical work on diveristy-stability relationships typically suffers from the same limitation, ignoring the processes by which temporal environmental variability can promote coexistence and increase species richness [Loreau 2010, but see @Chesson2001].

Fluctuating environmental conditions are an important ingredient for stable species coexistence, both in theoretical models [@Chesson2000; @Chesson2004] and in natural communities [@Caceres1997; @Descamps-Julien2005; @Adler2006; @Angert2009].
Such "fluctuation-dependent" coexistence requires that species have unique environmental responses and that environmental conditions vary so that each species in a community experiences favorable and unfavorable conditions, which prevents competitive exclusion [@Chesson2000].
When coexistence is maintained by a fluctuation-dependent mechanism, an increase in environmental variability might lead to an increase in species richness and, consequently, an increase in ecosystem stability.
However, increasing environmental variability may also decrease ecosystem stability by increasing the fluctuations of individual species, regardless of species richness.

The countervailing effects of environmental variability present an interesting paradox: increasing variability should decrease ecosystem stability, but the potential for an increase in richness might offset the decrease in stability.
Such a paradox complicates predictions about how ecosystems will respond as environmental conditions exceed historical ranges of variability.
The unknown net effect of environment variability may be reflected in the mixed results from empirical studies on the diversity-stability relationship.
Observational tests of the diversity-stability relationship, which require sampling across natural diversity gradients, have yielded positive [@Hautier2014], neutral [@Valone2003; @Cusson2015], and negative [@Sasaki2011] relationships.
In a meta-analysis of diversity-stability relationships based on observational studies in terrestrial ecosystems, @Jiang2009 found no significant evidence for an effect of species richness on ecosystem stability.
The idiosyncratic results of these empirical studies contrasts with the consistent conclusions from theoretical work.

The gap between theoretical expectations and empirical results of richness-stability relationships reflects the divergence of theory developed to explain species coexistence and theory developed to explain diversity and stability.
One reason these two disciplines have diverged is because they have focused on slightly different questions.
Diversity-stability studies typically ask how ecosystem variability responds to different levels of species richness at a given level of environmental variability [reviewed in @Kinzig2001; @Loreau2010], whereas coexistence studies ask how the long term stability of species coexistence responds to different levels of environmental variability [@Chesson1981a].

To reconcile these two perspectives, we extend theory on the relationship between species richness and ecosystem stability to cases in which species coexistence explicitly depends on environmental fluctuations and species-specific responses to environmental conditions.
We focus on the temporal storage effect and relative nonlinearity using a general consumer-resource model.
We use the model to investigate three questions:

1. Does the direction of the diversity-stability relationship remain positive when species coexistence is fluctuation-dependent? 

2. When species coexistence is fluctuation-dependent, how does increasing environmental variability impact ecosystem stability?

3. Do our answers to the previous two questions depend on the specific fluctuation-dependent coexistence mechanism (i.e., storage effect vs. relative nonlinearity)?


MATERIALS AND METHODS
---------------------
###  Consumer-resource model
We developed a semi-discrete consumer-resource model that allows many species to coexist on one resource by either the storage effect or relative nonlinearity. 
In our model, the consumer can be in one of two-states: a dormant state $D$ and a live state $N$.
The dormant state could represent, for example, the seedbank of an annual plant.
Transitions between $N$ and $D$ occur at discrete intervals $\tau$ with continuous-time consumer-resource dynamics between discrete transitions. 
Thus, our model is formulated as "pulsed differential equations" [@Pachepsky2008; @Mailleret2009; @Mordecai2016]. 
For clarity we refer to $\tau$ as years and the growing time between years as seasons with daily ($t$) time steps. 

During a growing season, consumer-resource dynamics are modeled as two differential equations:

\begin{align}
\frac{\text{d}N_{i}}{\text{d}t} &= N_{i}\epsilon_if_{i}(R), \quad t \ne \tau_k\\
\frac{\text{d}R}{\text{d}t} &= - \sum\limits_{i=1,2}f_{i}(R)N_{i}, \quad t \ne \tau_k
\end{align}

\noindent where the discrete transitions between $N$ and $D$ occur between seasons at times $\tau_k$, $k = 1,2,3, \dots, K$. The subscript $i$ denotes species, $N$ is the living biomass state, and $\epsilon_i$ is each species' resource-to-biomass conversion efficiency. The growth rate of living biomass is a resource-dependent Hill function, $f_{i}(R) = r_{i}R^{a_{i}} / (b_{i}^{a_{i}}+R^{a_{i}})$, where *r* is a species' intrinsic growth rate and *a* and *b* define the curvature of the function. Resource depletion is equal to the sum of each species' consumption. 

Along with resource uptake, consumer population growth depends on the production of dormant biomass ($D$), the activation of dormant biomass to live biomass ($D \rightarrow N$), and the survival of living biomass from one year to the next. The biomass of each species' states at the start of a growing season are equal to

\begin{align}
  D_{i}(\tau_k^+) &= (1-\gamma_{i,\tau_k})[\alpha_i N_{i}(\tau_k) + D_{i}(\tau_k)](1-\eta_i) \\
  N_{i}(\tau_k^+) &= (1-\alpha_i)N_{i}(\tau_k) + \gamma_{i,t}[\alpha_i N_{i}(\tau_k) + D_{i}(\tau_k)] (1-\eta_i),
\end{align}

\noindent where $D(\tau_k)$, $N(\tau_k)$, and $R(\tau_k)$ are the abundances of each state at the end of growing season *k* and $\tau_k^+$ denotes the beginning of growing season $k=1$. 
The activation of dormant biomass to live biomass is controlled by $\gamma$, which is year (*k*) and species (*i*) specific.
Dormant biomass is equal to a constant fraction ($\alpha$) of live biomass at the end of the previous season ($N_{i}(\tau_k)$), plus survival ($1-\eta_i$) of dormant biomass ($D_{i}(\tau_k)$) at the end of the previous year and dormant biomass remaining after live biomass activation ($D_{i}(\tau_k)(1-\gamma_{i,\tau_k})$).
Live biomass is equal to newly activated dormant biomass ($\gamma_{i,t}[D_{i}(\tau_k)$), minus some fraction of live biomass that is converted to dormant biomass ($(1-\alpha_i)N_{i}(\tau_k)$)
We assume the resource pool is not replenished within a growing season.
Resource replenishment occurs between growing seasons, and the resource pool (*R*) at the start of the growing season *k*+1 is $R(\tau_k^+) = R^+$, where $R^+$ is a random resource pulse drawn from a log-normal distribution with mean $\mu(R^+)$ and standard deviation $\sigma(R^+)$. 
Model parameters and notation are described in Table 1.

#### Implementing the Storage Effect
For the storage effect to operate, we need species-specific responses to environmental variability, density-dependent covariance between environmental conditions and competition (*EC* covariance), and subadditive population growth [@Chesson1994; @Chesson2000a]. 
Regardless of the mechanism, long-term coexistence is possible when all species can increase when rare.
In the storage effect, rare species increase by escaping the effects of *EC* covariance.
This happens because common species will experience greater than average competition (*C*) in good environment (*E*) years because common species cannot avoid intraspecific competition.
Rare species do not have this problem and can increase rapdily in a good *E* year.
*EC* covariance is included in our model because dormant-to-live transition rates ($\gamma$) are species-specific and vary through time.
In a high $\gamma$ year for a common species, resource uptake will be above average, while in a high $\gamma$ year for a rare species, resource uptake will be below average.

Subadditive population growth buffers populations against large population decreases in unfavorable years. 
It is included in our model because we include a dormant stage with very low death rates, which limits large population declines.
In combination, subadditive population growth limits population declines in bad *E* years, and *EC* covariance ensures species can increase rapidly when rare but suffer when common.

We generated sequences of (un)correlated dormant-to-live state transition rates ($\gamma$) for each species by drawing from multivariate normal distributions with mean 0 and a variance-covariance matrix ($\Sigma(\gamma)$) of

\begin{align}
\Sigma(\gamma) = 
\begin{bmatrix}
\sigma^2_{E} & \rho_{1,2}\sigma^2_{E} & \rho_{1,3}\sigma^2_{E} & \rho_{1,4}\sigma^2_{E} \\
\rho_{2,1}\sigma^2_{E} & \sigma^2_{E} & \rho_{2,3}\sigma^2_{E} & \rho_{2,4}\sigma^2_{E} \\
\rho_{3,1}\sigma^2_{E} & \rho_{3,2}\sigma^2_{E} & \sigma^2_{E}  & \rho_{3,4}\sigma^2_{E} \\
\rho_{4,1}\sigma^2_{E} & \rho_{4,2}\sigma^2_{E} & \rho_{4,3}\sigma^2_{E} & \sigma^2_{E}  \\
\end{bmatrix}
\end{align}

\noindent where $\sigma^2_{E}$ is the variance of the environmental cue and $\rho_{i,j}$ is the correlation between between the species *i*'s and species *j*'s transition rates. 
$\rho$ must be less than 1 for stable coexistence, and in all simulations we placed that constraint that $\rho_{i,j} = \rho_{j,i}$ for each species pair.
The inferior competitor has the strongest potential to persist when $\rho=-1$ (perfectly uncorrelated transition rates). 
We used the ```R``` function ```mvrnorm``` to generate sequences of (un)correlated variates *E* that we converted to germination rates in the 0-1 range: $\gamma = e^E / 1 + e^E$.
Note that $\Sigma(\gamma)$ must be positive definite.
So, after defining $\Sigma(\gamma)$ with all $\rho_{i,j}$s and $\sigma^2_{E}$, we used the ```nearPD``` function from the ```Matrix``` package in ```R``` to coerce the variance-covariance matrix to be positive definite.

#### Implementing Relative Nonlinearity
In the absence of environmental fluctuations, the outcome of competition between two species limited by the same resource is determined by the shape of their resource uptake curves.
That is, at constant resource supply, whichever species has the lowest resource requirement at equilibrium ($R^*$) will exclude all other species [@Tilman1982].
Resource fluctuations create opportunities for species coexistence because the resource level is then not fixed at the $R^*$ of the superior competitor.
If the resource uptake curves of each species are relatively nonlinear, then some species will be able to take advantage of resource levels that other species cannot [@Chesson1994].

For example, in Fig. 1C we show two species' resource uptake curves that are relatively nonlinear.
Species B has the lowest $R^*$ and would competitively exclude species A in the absence of environmental fluctuations.
But, fluctuating resource supplies can benefit species A because it can take advantage of relatively high resource levels due its higher saturation point.
Stable coexistence is only possible, however, if each species creates a disadvantage for itself when abundant.
This occurs in our model because when a resource conservative species (e.g., species B in Fig. 1C) is abundant, resource levels will remain high for a longer period of time because its draw down of resources starates.
Likwise, when a resource acquisative species (e.g., species A in Fig. 1C) is abundant it quickly draws down resources to levels that favor resource conservative species.
Such reciprocity ensures species can increase when rare and stablizes coexistence [@Armstrong1980; @Chesson2000; @Chesson2004].

### Numerical simulations
To explore how fluctuation-dependent coexistence can affect the diversity-stability relationship, we simulated the model with four species under two scenarios for each coexistence mechanism.
First, we allowed the variance of the environment to determine how many species can coexist, akin to a community assembly experiment with a species pool of four species.
To do this, we simulated communities with all species initially present across a gradient of annual resource variability (for relative nonlinearity) or environmental cue variability (for the storage effect).
Second, we chose parameter values that allowed coexistence of all four species and then performed species removals, akin to a biodiversity-ecosystem function experiment.
The two simulation experiments correspond to (i) sampling ecosystem function across a natural gradient of species richness and (ii) sampling ecosystem function across diversity treatments within a site.

To understand how increasing environmental variability will impact ecosystem stability when coexistence is fluctuation-dependent, we simulated the model over a range of species pool sizes and environmental cue or resource variability.
For each size of species pool (1, 2, 3, or 4 species), we simulated the model at 15 evenly-spaced levels of environmental cue (range = 0.1,2) for the storage effect and 25 evenly-spaced levels of resource variability (range = 0.1,1.4) for relative nonlinearity.
We also explored the influence of asymmetries in species' competitive abilities and correlations in species' environmental responses within the storage effect model.

Under relative nonlinearity, species' resource response curves (Fig. S1-1) reflect traits that determine the intrinsic stability of each species.
Therefore, we ran two sets of simulations for relative nonlinearity: one where the species pools increased from stable to unstable species and vice versa.
For example, if species A is the most stable species and species D is the least stable we ran simulations where the species pool increased from one to four species as A then B then C then D.
We then ran simulations with that order reversed.

All simulations were run for 5,000 seasons with 20-day growing seasons. 
We averaged biomass over the growing season, and those yearly values were used to calculate total community biomass in each year.
After discarding an initial 500 seasons to reduce transient effects on our results, we calculated the coffecient of variation (*CV*) of summed species biomass through time, which represents ecosystem variability,  the inverse of ecosystem stability.
We calculated species richness as the number of species whose average biomass was greater than 1 over the course of the simulation.
Parameter values for specific results are given in figure captions.
Within-season dynamics were solved given initial conditions using the package ``deSolve`` [@Soetaert2010] in ``R`` [@Team2013].
```R``` code for our model function is in the Supporting Information Appendix S1.
All model code has been deposited on Figshare (*link*) and is available on GitHub at http://github.com/atredennick/Coexistence-Stability.


RESULTS
-------
When we allowed the variance of the environment to determine the number of coexisting species from an initial community of four, we found a positive relationship between diversity and variability (Fig. 2A,C).
This was true for the storage effect, where coexistence is maintained by fluctuating transition rates ($\gamma$), and for relative nonlinearity, where coexistence is maintained by annual resource pulses.
The relationship is driven by the fact that, under both coexistence mechanisms, the strength of species coexistence increased with environmental variability (Fig. S1-2).
Therefore, more variabile conditions promoted species richness, creating a positive relationship between diversity and variability.

When we performed species removals at given levels of environmental variability, we found the typical negative diversity-variability relationship (Fig. 2B,D).
The relationship is very constrained for the storage effect because all species have similar temporal variances.
Therefore, regardless of species identity, having more species will always stabilize ecosystem functioning through portfolio effects.
On the contrary, the relationship is less strong for relative nonlinearity (Fig. 2D) because each species has unique temporal variance depending on its resource uptake curve.
Depending on the specific combination of species, two-species communities may sometimes be less variable than three-species communities.

To analyze the above results in more detail, we simulated our model over range of environmental variance and species pool sizes.
In Fig. 3 we show storage effect simulation results where environmental variability determines species coexistence from a regional species pool of four species.
We also show results from nested subsets of the four species pool (e.g., only two species in the pool instead of four) to show the trajectory of ecosystem variability if new species are not present to join the local community.
We find that realized species richness increases with environmental variability and, in some cases, increasing variability can actually completely temper the effect of increasing environmental variability.
More species rich communities are less variable on average and increase in ecosystem *CV* at a slower rate (e.g., lower slopes in log-log space; Fig. S1-3). 

The dampening effect of fluctuation-dependent coexistence on increasing environmental variability depends on the specific traits (parameter values) of the species in the regional pool.
Asymmetric competition makes it more difficult for new species to enter the local community (Fig. 3; compare top and bottom panels).
Relatively high competition also increases the rate at which ecosystem *CV* increases with environmental variance (Fig. S1-3).
This is because the abundance of inferior competitors is reduced and therefore does not influence ecosystem *CV* as much as when competition is symmetric.
The correlation of species' environmental responses also mediates the relationship between environmental variance, species richness, and ecosystem *CV*: lower correlations make it easier for new species to coexist and unique environmental responses are always stabilizing (Fig. 3).

In communities where species coexist via relative nonlinearity, whether or not the direct impact of environmental variability on ecosystem variability is tempered by species additions depends on the species traits of immigrating species.
When additional species, which immigrate from the regional pool, are less intrinsically stable than the resident species, ecosystem variability increases at a constant rate even as species are added (Fig. 4A).
On the contrary, if more stable species are added, species additions buffer the ecosystem from increasing environmental variability (Fig. 4B).
The stability of individual species in our relative nonlinearity model is determined by their respective resource response curves (Fig. S1-1).
Under relative nonlinearity, we find that the buffering effect of species additions depends on species traits, and the order in which species enter the local community.
Indeed, if all species in the regional pool are less stable than the resident species, then no stabilization occurs as species are added (Fig. 4A).


DISCUSSION
----------
Theory developed for biodiversity-ecosystem function experiments emphasizes that increases in species richness should reduce ecosystem variability. 
Consistent with theoretical expectations from models in which species coexistence is maintained by fluctuation-independent mechanisms, we produced the typical negative diversity-variability relationship (Fig. 2B,D) from a model with fluctation-dependent species coexistence [also see @Chesson2001].
Likewise, our results from the species removal simulations are consistent with results from biodiversity-ecosystem functioning experiments showing a negative relationship between species richness and ecosystem variability.
This is encouraging because species almost certainly coexist by some combination of fluctuation-independent (e.g., resource partitioning) and fluctuation-dependent mechanisms.
By extending theory to communities where species richness is explicitly maintained by temporal variability, we have gained confidence that experimental findings are generalizable to many communities.
In other words, in local settings where environmental variability is relatively homogenous, reductions in the number of species will reduce the stability of ecosystem functioning, regardless of how coexistence is maintained.

When we allowed a gradient of environmental variability to determine species coexistence, we discovered a positive relationship between species richness and ecosystem variability (Fig. 2A,C).
While surprising when viewed through the lens of previous theory and experimental findings, such a relationship is a direct consequence of how diversity can be maintained in fluctuating environments.
The storage effect and relative nonlinearity both require envrionmental fluctuations to allow niche differentiation between species pairs [@Chesson2000].
Therefore, species coexistence gains strength, for both mechanisms, as the environment becomes more variable (Fig. S1-2).

Our results may explain why deviations from the negative diversity-variability relationship often come from observational studies [@Jiang2009].
Observational studies must rely on natural diversity gradients, and if species richness depends on environmental variability, it is entirely possible to observe positive diversity-variability relationships.
For example, Sasaki and Lauenroth (2011) found a negative relationship between species richness and the temporal stability of plant abundance (a positive diversity-variability relationship) in a semi-arid grassland.
Their data came from a six sites that were 6 km apart.
While Sasaki and Lauenroth explained their results in terms of dominant species' effects, it is also possible that each site experienced slightly different levels of environmental variability that influenced species coexistence.
@DeClerck2006 also found a positive diversity-variability when sampling conifer richness and the variability of productivity across a large spatial gradient in the Sierra Nevada.

While our modeling results show that fluctuation-dependent coexistence can create positive diversity-variability relationships, whether such trends are detected will depend on the particular traits of the species in the community and the relative influence of fluctuation-dependent and fluctuation-independent coexistence mechanisms, which are not mutually exclusive.
Thus, our results may also help explain observational studies where no relationship between diversity and variability is detected.
For example, @Cusson2015 found no relationship between species richness and variability of abundances in several marine macro-benthic ecosystems.
Many of their focal ecosystems were from highly variable intertidal environments.
If coexistence was at least in part determined by environmental fluctuations, then the confounding effect of variability and species richness could compensate any direct effect of species richness on variability.
Previous theoretical work showed how environmental variation can mask the effect of species diversity on ecosystem productivity when sampling across sites [@Loreau1998].
Our mechanistic model extends that conclusion to ecosystem stability.

Whether coexistence is fluctuation-independent or fluctuation-dependent becomes especially important when we consider how ecosystem stability responds to increasing environmental variability.
In the fluctuation-independent case, species richness is essentially fixed because the species' inequalities that determine coexistence (niche and fitness differences) are not linked to environmental variability.
Therefore, increasing environmental variability will always increase ecosystem variability by increasing the fluctuations of individual species' abundances.

When coexistence is fluctuation-dependent, however, more interesting things happen.
By simulating communities with different species pool sizes across a gradient of environmental variabilitym, we show that species gains due to increasing environmental variability can temper the direct effect of environmental variability on ecosystem variability (Figs. 3 and 4).
These results lead to two conclusions.

First, when predicting the impacts of increasing environmental variability on ecosystem stability, the mechanism of coexistence in the community matters.
Fluctuation-dependent coexistence can buffer ecosystems from increasing environmental variability by allowing for species additions.
Whether our theoretical predictions hold in real communities is unknown and requires empirical tests.
Doing so would require manipulating environmental variability in communities where coexistence is known to be fluctuation-dependent, at least in part.
Such data do exist [@Angert2009], and a coupled modeling-experimental approach could determine if our predictions hold true in real communities.

Second, whether local fluctuation-dependent communities can receive the benefit of additional species depends on a diverse regional species pool.
If the regional pool is not greater in size than the local species pool, than ecosystem stability will decline with environmental variability in a similar manner as in fluctuation-independent communities because species richness will be fixed (Fig. 5A,B).
Metacommunity theory has made clear the importance of rescue effects to avoid species extinctions [@Brown1997; @Leibold2004].
Here, instead of local immigration by a resident species working to rescue a species from extinction, immigration to the local community by a new species rescues ecosystem processes from becoming less stable (Fig. 5C,D).
Thus, our results reinforce the importance of both local and regional biodiversity conservation.
Just as declines in local species richness can destabilize ecosystem functioning [@Tilman2006; @Hector2010; @Hautier2014], species losses at larger spatial scales can also weaken stability.
@Wang2014 show that regional ecosystem stability depends on regional biodiversity through its effects on beta diversity and, in turn, the asynchrony of functioning in local communities.
Our results show that, when coexistence is fluctuation-dependent, regional biodiversity declines could also affect local ecosystem functioning by limiting local species additions that could be possible under scenarios of increasing environmental variability (Fig. 5).

Species coexistence in real ecological communities probably emerges from some combination of fluctuation-independent and fluctuation-dependent mechanisms [@Chesson2000; @Clark2010].
Likewise, environmental conditions in real ecosystems are unlikely to change only in their variability without an associated change in the mean [@Avolio2015].
Therefore, environmental change has the potential to alter the niche and fitness differences among species in multiple ways, some of which were not present in our current analysis.
Mean changes in environmental conditions could reorder competitive hierarchies [@Klanderud2005] and/or alter the availability of niches [@Harpole2016].
Associated changes in ecosystem stability will depend upon the magnitude of environmental change, each species' response to the particular environmental driver, and biotic interactions [@Hallett2014a].
Thus, it is becoming clear that understanding how ecosystem stability will respond to global change will require a trait-based approach.


ACKNOWLEDGMENTS
---------------
The National Science Foundation provided funding for this work through a Postdoctoral Research Fellowship in Biology to ATT (DBI-1400370) and a CAREER award to PBA (DEB-1054040).

\newpage{}

TABLE
-----

\begin{table}[!htbp]
\footnotesize
\caption{Default values of model parameters and their descriptions. Parameters that vary depending on the mode and strength of species coexistence or depending on species copmetive hierarchies are labeled as "variable" in parantheses. The dormant-to-live biomass transition fraction ($\gamma$) is a function of other parameters, so has no default value.}
\begin{tabular}{l l l}
\hline
Parameter & Description & Value \\
\hline
$r$ & maximum per capita growth rate & 1 (variable) \\
$a$ & Hill function rate parameter & 2 (variable) \\
$b$ & Hill function curvature parameter & 2.5 (variable) \\
$\epsilon$ & resource-to-biomass conversion efficiency & 0.5 \\
$\alpha$ & allocation fraction of live biomass to dormant biomass & 0.5 (variable) \\
$\gamma$ & dormant-to-live biomass transition fraction & -- \\
$\rho$ & correlation of species' response to the environment & 0 (variable) \\
$\sigma_E$ & variance of the environmental cue & 2 (variable) \\
$\eta$ & dormant biomass mortality rate & 0.1 \\
$\mu(R^+)$ & mean annual resource pulse & 20 (non-log scale) \\
$\sigma(R^+)$ & standard deviation of annual resource pulse & 0 (variable) \\
\hline
\end{tabular}
\end{table}

\newpage{}

FIGURES
-------
```{r model_types, cache=FALSE, warning=FALSE, message=FALSE, eval=TRUE, fig.height=3, fig.width=5, fig.cap="Resource uptake functions and example time series of (un)correlated germination fractions for the storage effect (A,B) and relative nonlinearity (C,D) formulations of the consumer-resource model. The resource uptake functions for both species are equivalent for the storage effect, but their germination fractions are uncorrelated in time. The opposite is true for relative nonlinearity: the two species have unique resource uptake functions, but their germination fractions are perfectly correlated in time."}
library(ggplot2)
library(ggthemes)
library(mvtnorm)
library(gridExtra)
# mycols <- c("#9D6188","#97A861")
mycols <- c("black", "red")
# mycols <- c("grey35", "steelblue")

mytheme <- theme(axis.text=element_text(size=6),
                 axis.title=element_text(size=8),
                 legend.text=element_text(size=6),
                 legend.key.size=unit(0.3, "cm"))

 ##  Resource uptake function (Hill function)
  uptake_R <- function(r, R, alpha, beta){
    return((r*R^alpha) / (beta^alpha + R^alpha))
  }
  # Get "germination" fractions for each year
  getG <- function(sigE, rho, nTime){
    varcov <- matrix(c(sigE, rho*sigE, rho*sigE, sigE), 2, 2)
    e <- rmvnorm(n = nTime, mean = c(0,0), sigma = varcov)
    g <- exp(e) / (1+exp(e))
    return(g)
  }

## STORAGE EFFECT PLOTS
parms <- list(
  r = c(5,5),         # max growth rate for each species
  alpha = c(5,5),     # rate parameter for Hill function 
  beta = c(20,20),    # shape parameter for Hill function
  mN = c(0.5,0.5),    # live biomass loss (mortality) rates 
  mD = c(0.01, 0.01), # dormant biomass loss (mortality) rates
  a = c(0.5,0.5)      # allocation fraction of live biomass to seed bank
)
R <- seq(0,100,1)
out_r <- matrix(ncol=2, nrow=length(R))
alpha <- parms$alpha
beta <- parms$beta
for(i in 1:nrow(out_r)){
  out_r[i,1] <- uptake_R(parms$r[1], R[i], alpha[1], beta[1])
  out_r[i,2] <- uptake_R(parms$r[2], R[i], alpha[2], beta[2])
}
strg_uptake <- data.frame(species=rep(c(1:2), each=nrow(out_r)),
                          resource=rep(R, times=2),
                          uptake=c(out_r[,1], out_r[,2]))
strg_uptake_plot <- ggplot()+
  geom_line(data=strg_uptake, aes(x=resource, y=uptake, color=as.factor(species), linetype=as.factor(species)))+
  theme_few()+
  scale_color_manual(values=mycols, name="", labels=c("Species A", "Species B"))+
  guides(size=FALSE, linetype=FALSE)+
  xlab("Resource")+
  ylab("Resource Uptake Rate")+
  theme(legend.position=c(0.7,0.35))+
  geom_text(aes(x=1,y=5, label="A"), size=2.5)+
  mytheme

sigE <- 2   # environmental cue variability
rho <- 0    # environmental cue correlation between species
gVec <- getG(sigE = sigE, rho = rho, nTime = 20)
germ_rate <- data.frame(species=rep(c(1:2),each=20),
                        timestep=rep(c(1:20), times=2),
                        germrate=c(gVec[,1], gVec[,2]))
strg_germ_plot <- ggplot()+
  geom_line(data=germ_rate,aes(x=timestep, y=germrate, color=as.factor(species), linetype=as.factor(species)))+
  theme_few()+
  scale_color_manual(values=mycols, name="Species")+
  guides(size=FALSE, linetype=FALSE, color=FALSE)+
  xlab("Simulation Year")+
  ylab("Germination Fraction")+
  geom_text(aes(x=1,y=1,label="B"), size=2.5)+
  mytheme


## RELATIVE NONLINEARITY PLOTS
parms <- list(
  r = c(5,1),          # max growth rate for each species
  alpha = c(5,2),      # rate parameter for Hill function 
  beta = c(20,2.5),    # shape parameter for Hill function
  mN = c(0.5,0.5),     # live biomass loss (mortality) rates 
  mD = c(0.01, 0.01),  # dormant biomass loss (mortality) rates
  a = c(0.5,0.5)       # allocation fraction of live biomass to seed bank
)
R <- seq(0,100,1)
out_r <- matrix(ncol=2, nrow=length(R))
alpha <- parms$alpha
beta <- parms$beta
for(i in 1:nrow(out_r)){
  out_r[i,1] <- uptake_R(parms$r[1], R[i], alpha[1], beta[1])
  out_r[i,2] <- uptake_R(parms$r[2], R[i], alpha[2], beta[2])
}
reln_uptake <- data.frame(species=rep(c(1:2), each=nrow(out_r)),
                          resource=rep(R, times=2),
                          uptake=c(out_r[,1], out_r[,2]))
reln_uptake_plot <- ggplot()+
  geom_line(data=reln_uptake, aes(x=resource, y=uptake, color=as.factor(species), linetype=as.factor(species)))+
  theme_few()+
  scale_color_manual(values=mycols, name="Species")+
  guides(size=FALSE, linetype=FALSE, color=FALSE)+
  xlab("Resource")+
  ylab("Resource Uptake Rate")+
  geom_text(aes(x=1,y=5,label="C"), size=2.5)+
  mytheme

sigE <- 2   # environmental cue variability
rho <- 1    # environmental cue correlation between species
gVec <- getG(sigE = sigE, rho = rho, nTime = 20)
germ_rate <- data.frame(species=rep(c(1:2),each=20),
                        timestep=rep(c(1:20), times=2),
                        germrate=c(gVec[,1], gVec[,2]))
reln_germ_plot <- ggplot()+
  geom_line(data=germ_rate,aes(x=timestep, y=germrate, color=as.factor(species), linetype=as.factor(species)))+
  theme_few()+
  scale_color_manual(values=mycols, name="Species")+
  guides(size=FALSE, linetype=FALSE, color=FALSE)+
  xlab("Simulation Year")+
  ylab("Germination Fraction")+
  geom_text(aes(x=1,y=1,label="D"), size=2.5)+
  mytheme

g_strg <- grid.arrange(strg_uptake_plot, strg_germ_plot, 
                       reln_uptake_plot, reln_germ_plot,
                       ncol=2, nrow=2)
```

\newpage{}

\begin{figure}[!ht]
  \centering
      \includegraphics{./components/main_figure_hires.png}
  \caption{Variability of total community as function of species richness when coexistence is maintained by the storage effect (A,B) or relative nonlinearity (C,D). Top panels show results from simulations where environmental or resource variance determine the number species that coexist in a community. Bottom panels show results from simulations where environmental or resource variance is fixed at a level that allows coexistence of all four species, but speces are removed to manipulate diversity. The top panels represent regional diversity-stability relationships across natural diversity gradients, whereas the bottom panels represent local diversity-stability relationships.}
\end{figure}

\newpage{}

\begin{figure}[!ht]
  \centering
      \includegraphics[height=5in]{./components/storage_effect_div+envar_varycomp.png}
  \caption{The effect of environmental variability on ecosystem variability with associated effects of species richness when species coexist via the storage effect. Panels (A-C) show simulation results where species have slightly asymmetrical competitive effects, whereas panels (D-F) show results when competition is more asymmetric. We show results for different levels of correlations of species' environmental responses, $\rho$.}
\end{figure}

\newpage{}

\begin{figure}[!ht]
  \centering
      \includegraphics[height=2.5in]{./components/relative_nonlinearity_div+envar.png}
  \caption{The effect of environmental variability on ecosystem variability with associated effects of species richness when species coexist via relative nonlinearity. (A) The species pool increases from 1-4 four species, with the fourth species being most unstable. Increasing environmental variability (the SD of annual resource availability) allows for greater species richness, but species additions do not modulate the effect of environmental variability on ecosystem variability. (B) The species pool increases from 1-4 four species, with the fourth species being most stable (though, the fourth species was unable to coexist under these parameter values). In this case increasing environmental variability allows for greater realized species richness and can temper the effect of environmental variability.}
\end{figure}

\newpage{}

\begin{figure}[!ht]
  \centering
      \includegraphics[height=4in]{./components/coexistence_stability_infographic_v2.png}
  \caption{Example of how species additions under increasing environmental variability can buffer ecosystem stability when species coexistence is fluctuation-dependent via the storage effect. Environmental variability ($\sigma^2_E$) increases linearly with time. (A) Time series of species' biomasses (colored lines) in a closed community where colonization of new species is not possible and (B) its associated coefficient of variation (Rolling CV; calculated over 100-yr moving window) through time. (C) Time series of species' biomasses in an open community where colonization by new species from the regional pool of four species becomes possible as environmental variation increases. The trajectory of total biomass CV in the open community (D) asymptotes at lower variability than in the closed community (B) due to the buffering effect of species richness.}
\end{figure}

\newpage{}

<!---
\begin{figure}[!ht]
  \centering
      \includegraphics{./components/fig2_formatted.png}
  \caption{Variability of community biomass and invasion growth rates of the inferior competitor under different parameter combinations. Points are mean values from 10,000 growing seasons and lines are linear fits to show trends. In \textbf{Storage Effect} plots, resource supply is held constant between growing seasons, whereas resource supply varies each year in \textbf{Relative Nonlinearity} simulations.}
\end{figure}

\begin{figure}[!ht]
  \centering
      \includegraphics{./components/profile_plots_formatted.png}
  \caption{Variability of total community biomass and invasion growth rates of the inferior competitor when the storage effect is strong ($\rho=-0.5$) and weak ($\rho=0.5$), with (filled circles) and without (open circles) relative nonlinearity contributing to coexistence. Simulations without relative nonlinearity were run with species having (\emph{a}) low, (\emph{b}) moderate, and (\emph{c}) high maximum growth rates. Small plots above the main panels shows species resource uptake curves associated with each simulation.}
\end{figure}

\begin{figure}[!ht]
  \centering
      \includegraphics[width=3in]{./components/persp_plots_formatted.png}
  \caption{Variability of total community biomass (\emph{a}) and species richness (\emph{b}) as a function of the variance of the environmental cue ($\sigma^2_E$), and the correlation of species responses to the environment ($\rho$). }
\end{figure}

\begin{figure}[!ht]
  \centering
      \includegraphics{./components/diversity_stability_relationship.png}
  \caption{Variability of total community biomass as a function of the the number of coexisting species at different levels of correlations of species' responses to environmental conditions ($\rho$).}
\end{figure}

\begin{figure}[!ht]
  \centering
      \includegraphics{./components/storage_effect_growthrate_cv.png}
  \caption{Relationship between the strength of coexistence (invasion growth rate of inferior competitor) and ecosystem variability. Panels show different levels of environmental cue variability (denoted by number at top of each panel). Color bar shows the correlation between species' germination rates.}
\end{figure}

\begin{figure}[!ht]
  \centering
      \includegraphics{./components/storage_effect_synchstability.png}
  \caption{Results from storage effect simulations showing the relationships between the correlation of species' responses to the environmental cue for germination and simulated species asynchrony (\textit{a}), coefficient of variation of total community biomass (\textit{b}), mean total community biomass (\textit{c}), and standard deviation of total community biomass (\textit{d}). Color ramps indicate the value of resource variability ($\sigma_R$) for a given simulation.}
\end{figure}

\begin{figure}[!ht]
  \centering
      \includegraphics{./components/relative_nonlinearity_synchstability.png}
  \caption{Results from relative nonlinearity simulations showing the relationships between tresource variability ($\sigma_R$) and simulated species asynchrony (\textit{a}), coefficient of variation of total community biomass (\textit{b}), mean total community biomass (\textit{c}), and standard deviation of total community biomass (\textit{d}). The correlation of species' responses to the environmental cue for germination was equal to one for all relative nonlinearity simulations ($\rho=1$).}
\end{figure}


\begin{figure}[!ht]
  \centering
      \includegraphics[width=3in]{./components/strength_v_cv.png}
  \caption{Relationship between the strength of coexistence (invasion growth rate of inferior competitor) and ecosystem variability.}
\end{figure}

\begin{figure}[!ht]
  \centering
      \includegraphics{./components/compare_plots.png}
  \caption{Relationship between resource variability ($\sigma_R$) and the coefficient of variation of total community biomass for both coexistence mechanisms. Each panel shows results from different levels of environmental cue correlations ($\rho$) for the storage effect; $\rho=1$ across all panels for relative nonlinearity results. On average, the storage effect leads to less variable biomass production through time.}
\end{figure}

-->



\setlength{\parindent}{0ex}
\singlespacing

REFERENCES
----------
