---
layout: 12pt
header-includes:
  - \usepackage{lineno}
  - \linenumbers
  - \usepackage{setspace}
  - \usepackage{todonotes}
  - \doublespacing
  - \usepackage{rotating}
  - \usepackage{color, soul}
  - \usepackage[font={footnotesize},labelfont={sf,bf},labelsep=space]{caption}
  - \usepackage{sectsty}
bibliography: ~/Dropbox/Bibliography/CoexistStability.bib
csl: components/ecology_letters.csl

## rmarkdown render options
output:
  pdf_document:
    fig_caption: true
    keep_tex: true
fontsize: 12pt
geometry: margin=1in
linkcolor: black
urlcolor: black
---

\renewcommand\linenumberfont{\normalfont\tiny\sffamily\color{gray}}

\newcommand{\tc}{\textcolor}

<!--
\allsectionsfont{\normalfont\sffamily\bfseries}
-->

\begin{singlespace}

\begin{centering}

\Large{The relationship between species richness and ecosystem variability is shaped by the mechanism of coexistence}

\vspace{2.5em}

\renewcommand*{\thefootnote}{\fnsymbol{footnote}}

\normalsize{Andrew T. Tredennick\textsuperscript{1}, Peter B. Adler\textsuperscript{1}, and Frederick R. Adler\textsuperscript{2}}

\vspace{1.5em}

\textit{\small{\textsuperscript{1}Department of Wildland Resources and the Ecology Center, Utah State University, Logan, Utah 84322}} \\
\textit{\small{\textsuperscript{2}Departments of Biology and Mathematics, University of Utah, Salt Lake City, Utah 84112}} 

\end{centering}

\vspace{3em}

Last compile: \today

\noindent \textbf{Keywords}: coexistence, storage effect, relative nonlinearity, diversity-stability hypothesis, pulsed differential equation, consumer-resource dynamics

\noindent \textbf{Authorship}: All authors conceived the research and designed the modeling approach; ATT conducted model simulations, with input from PBA and FRA; ATT wrote the manuscript and all authors contributed to revisions.

\noindent \textbf{Running Title}: Environmental variability, ecosystem variability, \& species coexistence

\noindent \textbf{Article Type}: Letter

\noindent \textbf{Number of Words}: 3,699

\noindent \textbf{Number of References}: 40

\noindent \textbf{Number of Tables and Figures}: 1 table, 5 figures

\noindent \textbf{Corresponding Author}:  \\
\phantom{222}Andrew Tredennick  \\
\phantom{222}Department of Wildland Resources and the Ecology Center  \\
\phantom{222}Utah State University  \\
\phantom{222}5230 Old Main Hill  \\
\phantom{222}Logan, Utah 84322 USA  \\
\phantom{222}Phone: +1-970-443-1599  \\
\phantom{222}Fax: +1-435-797-3796  \\
\phantom{222}Email: atredenn@gmail.com

\end{singlespace}

```{r caching, include=FALSE}
library("methods")
library("knitr")
basename <- "manuscript"
opts_chunk$set(fig.path = paste("components/figure/", basename, "-", sep=""),
               cache.path = paste("components/cache/", basename, "/", sep=""))
opts_chunk$set(cache = 2)
opts_chunk$set(tidy=FALSE, warning=FALSE, message=FALSE, 
               comment = NA, verbose = TRUE, echo=FALSE)

# PDF-based figures
opts_chunk$set(dev='pdf')
```


```{r plot-options, message=FALSE, warning=FALSE, include=FALSE, echo=FALSE}
cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", 
               "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

opts_chunk$set(dev='pdf', dev.args=c(version="1.3"))

```

<!--
ALTERNATIVE TITLES:
-FLUCTUATION-DEPENDENT COEXISTENCE AND THE DIVERSITY-STABILITY RELATIONSHIP
-THE DIVERSITY-STABILITY RELATIONSHIP IS SHAPED BY THE MECHANISM OF COEXISTENCE
-How fluctuation-dependent species coexistence affects the diversity-stability relationship
-->

\newpage{}

\begin{abstract}
Theory relating species richness to ecosystem variability typically ignores the potential for environmental variability to promote species coexistence.
Failure to account for fluctuation-dependent coexistence mechanisms may explain observed deviations from the expected negative diversity-variability relationship, and limits our ability to predict the consequences of future increases in environmental variability.
We use a consumer-resource model to explore how coexistence via the temporal storage effect and relative nonlinearity affects ecosystem variability.
We show that a positive, rather than negative, diversity-variability relationship is possible when ecosystem function is sampled across a natural gradient in environmental variability and diversity.
We also show how fluctuation-dependent coexistence can buffer ecosystem functioning against increasing environmental variability by promoting species richness and portfolio effects.
Our work provides a general explanation for variation in observed diversity-variability relationships and highlights the importance of conserving regional species pools to help buffer ecosystems against predicted increases in environmental variability.
\vspace{2em}
\end{abstract}


\newpage{}

\setlength{\parindent}{5ex}

INTRODUCTION
------------
@MacArthur1955, @Elton1958, and even Darwin [@Turnbull2013] recognized the potential for compensatory dynamics among species to stabilize ecosystem functioning in fluctuating environments. 
This idea underlies the "insurance hypothesis" [@Yachi1999], which suggests ecosystem variability decreases with diversity because species respond dissimilarly to environmental variation, broadening the range of conditions under which the community maintains function [@Loreau2010].
A variety of theoretical models all predict a negative relationship between species richness and ecosystem variability [@Lehman2000; @Ives2002b; @Loreau2013], and experimental tests tend to support such a prediction [@Tilman2006; @Hector2010].

However, the ability of biodiversity-ecosystem functioning (BEF) experiments to accurately represent real-world dynamics is debated [@Wardle2016; @Eisenhauer2016].
Much of the debate centers on the fact that BEF experimental protocols do not allow species gains to offset species losses.
Theoretical work on diversity-variability relationships typically suffers from the same limitation: it recognizes the role of environmental variability in driving population fluctuations which destabilize ecosystems, but ignores the potential for environmental variability to promote species richness and thereby help stabilize ecosystems [Loreau 2010, but see @Chesson2001].

Fluctuating environmental conditions are an important ingredient for stable species coexistence, both in theoretical models [@Chesson2000; @Chesson2004] and in natural communities [@Caceres1997; @Descamps-Julien2005; @Adler2006; @Angert2009].
Such "fluctuation-dependent" coexistence requires that species have unique environmental responses and that environmental conditions vary so that each species in a community experiences favorable and unfavorable conditions, which prevents competitive exclusion [@Chesson2000].
When coexistence is maintained by a fluctuation-dependent mechanism, an increase in environmental variability might lead to an increase in species richness and, consequently, a decrease in ecosystem variability.
However, increasing environmental variability may also increase ecosystem variability by increasing the fluctuations of individual species, regardless of species richness. 
These countervailing effects of environmental variability present an interesting paradox: while we should expect an increase in environmental fluctuations to increase ecosystem variability, this increase might be buffered if fluctuation-dependent coexistence adds new species to the community. 
Such a paradox complicates predictions about how ecosystems will respond to predicted departures from historical ranges of environmental variability.

The opposing effects of environmental variability on ecosystem variability might explain the mixed results from empirical studies on the diversity-variability relationship.
Observational tests of the diversity-variability relationship, which require sampling across natural diversity gradients, have yielded negative [@Hautier2014], neutral [@Valone2003; @Cusson2015], and positive [@Sasaki2011] relationships.
In a meta-analysis of diversity-variability relationships based on observational studies in terrestrial ecosystems, @Jiang2009 found no significant evidence for an effect of species richness on ecosystem variability, perhaps because environmental variability varies across natural diversity gradients, affecting both richness and ecosystem variability.
The idiosyncratic results of these empirical studies contrast with the consistent conclusions from theoretical work that ignores feedbacks between variability and richness.

The gap between theoretical expectations and empirical results of richness-variability relationships might reflect the divergence of theory developed to explain species coexistence and theory developed to explain diversity and ecosystem variability.
One reason these two disciplines have diverged is because they have focused on different questions.
Diversity-variability studies typically ask how ecosystem variability responds to different levels of species richness at a given level of environmental variability [reviewed in @Kinzig2001; @Loreau2010], whereas coexistence studies ask how species richness responds to different levels of environmental variability [@Chesson1981a].

To reconcile these two perspectives, we extend theory on the relationship between species richness and ecosystem variability to cases in which species coexistence explicitly depends on environmental fluctuations and species-specific responses to environmental conditions.
We focus on the temporal storage effect and relative nonlinearity using a general consumer-resource model.
We use the model to investigate two questions:

1. Does the diversity-variability relationship remain negative when species coexistence is maintained by the temporal storage effect or relative nonlinearity? 

2. How does increasing environmental variability impact ecosystem variability when coexistence depends on the storage effect or relative nonlinearity?


MATERIALS AND METHODS
---------------------
###  Consumer-resource model
We developed a semi-discrete consumer-resource model that allows many species to coexist on one resource by either the storage effect or relative nonlinearity. 
In our model, the consumer can be in one of two-states: a dormant state $D$ and a live state $N$.
The dormant state could represent, for example, the seed bank of an annual plant.
Transitions between $N$ and $D$ occur at discrete intervals $\tau$ with continuous-time consumer-resource dynamics between discrete transitions. 
Thus, our model is formulated as "pulsed differential equations" [@Pachepsky2008; @Mailleret2009; @Mordecai2016]. 
For clarity we refer to $\tau$ as years and the growing time between years as seasons with daily ($t$) time steps. 

During a growing season, consumer-resource dynamics are modeled as two differential equations:
\vspace{-3em}
\begin{align}
\frac{\text{d}N_{i}}{\text{d}t} &= \epsilon_if_{i}(R)N_{i}, \quad t \ne \tau_k\\
\frac{\text{d}R}{\text{d}t} &= - \sum\limits_{i}f_{i}(R)N_{i}, \quad t \ne \tau_k
\end{align}
\vspace{-3em}
\noindent where the discrete transitions between $N$ and $D$ occur between seasons at times $\tau_k$, $k = 1,2,3, \dots, K$. The subscript $i$ denotes species, $N$ is the living biomass state, and $\epsilon_i$ is each species' resource-to-biomass conversion efficiency. The growth rate of living biomass is a resource-dependent Hill function, $f_{i}(R) = r_{i}R^{a_{i}} / (b_{i}^{a_{i}}+R^{a_{i}})$, where *r* is a species' intrinsic growth rate and *a* and *b* define the curvature of the function. Resource depletion is equal to the sum of each species' consumption. 

Along with resource uptake, consumer population growth depends on the production of dormant biomass ($D$), the activation of dormant biomass to live biomass ($D \rightarrow N$), and the survival of living biomass from one year to the next. The biomass of each species' states at the start of a growing season are equal to
\vspace{-3em}
\begin{align}
  D_{i}(\tau_k^+) &= (1-\gamma_{i,\tau_k})[\alpha_i N_{i}(\tau_k) + D_{i}(\tau_k)](1-\eta_i) \\
  N_{i}(\tau_k^+) &= (1-\alpha_i)N_{i}(\tau_k) + \gamma_{i,t}[\alpha_i N_{i}(\tau_k) + D_{i}(\tau_k)] (1-\eta_i),
\end{align}
\vspace{-3em}
\noindent where $D(\tau_k)$, $N(\tau_k)$, and $R(\tau_k)$ are the abundances of each state at the end of growing season *k* and $\tau_k^+$ denotes the beginning of growing season $k$. 
The activation of dormant biomass to live biomass is controlled by $\gamma$, which is year (*k*) and species (*i*) specific.
Dormant biomass is equal to a constant fraction ($\alpha$) of live biomass at the end of the previous season ($N_{i}(\tau_k)$), plus survival ($1-\eta_i$) of dormant biomass ($D_{i}(\tau_k)$) at the end of the previous year and dormant biomass remaining after live biomass activation ($D_{i}(\tau_k)(1-\gamma_{i,\tau_k})$).
Live biomass is equal to newly activated dormant biomass ($\gamma_{i,t}D_{i}(\tau_k)$), minus some fraction of live biomass that is converted to dormant biomass ($(1-\alpha_i)N_{i}(\tau_k)$)
We assume the resource pool is not replenished within a growing season.
Resource replenishment occurs between growing seasons, and the resource pool (*R*) at the start of the growing season *k*+1 is $R(\tau_k^+) = R^+$, where $R^+$ is a random resource pulse drawn from a log-normal distribution with mean $\mu(R^+)$ and standard deviation $\sigma(R^+)$. 
Model parameters and notation are described in Table 1.

#### Implementing the Storage Effect
For the storage effect to operate, we need species-specific responses to environmental variability, density-dependent covariance between environmental conditions and competition (*EC* covariance), and subadditive population growth [@Chesson1994; @Chesson2000a]. 
Long-term coexistence is possible when all species can increase when rare.
In the storage effect, rare species increase by escaping the effects of *EC* covariance.
Common species will experience greater than average competition (*C*) in good environment (*E*) years because common species cannot avoid intraspecific competition.
However, rare species can escape intraspecific competition and have the potential to increase rapidly in a good *E* year.
*EC* covariance emerges in our model because dormant-to-live transition rates ($\gamma$) are species-specific and vary through time.
In a high $\gamma$ year for a common species, resource uptake will be above average, while in a high $\gamma$ year for a rare species, resource uptake will be below average, as long as $\gamma$s are not perfectly correlated between species.
Subadditive population growth buffers populations against large population decreases in unfavorable years. 
It is included in our model through a dormant stage with very low death rates, which limits large population declines in bad *E* years.

We generated sequences of (un)correlated dormant-to-live state transition rates ($\gamma$) for each species by drawing from multivariate normal distributions with mean 0 and a variance-covariance matrix ($\Sigma(\gamma)$) of
\vspace{-3em}
\begin{align}
\Sigma(\gamma) = 
\begin{bmatrix}
1 & \rho_{1,2} & \rho_{1,3} & \rho_{1,4} \\
\rho_{2,1} & 1 & \rho_{2,3} & \rho_{2,4} \\
\rho_{3,1} & \rho_{3,2} & 1  & \rho_{3,4} \\
\rho_{4,1} & \rho_{4,2} & \rho_{4,3} & 1  \\
\end{bmatrix}
\sigma_{E}^2,
\end{align}
\vspace{-2em}
\noindent where $\sigma^2_{E}$ is the variance of the environmental cue and $\rho_{i,j}$ is the correlation between species *i*'s and species *j*'s transition rates. 
$\rho$ must be less than 1 for stable coexistence, and in all simulations we constrained all $\rho_{i,j}$'s to be equal.
In a two-species community, the inferior competitor has the greatest potential to persist when $\rho=-1$ (perfectly uncorrelated transition rates). 
However, in a four-species community the minimum possible correlation among species is -1/3 given our constraints that all $\rho$'s are equal and that $\Sigma(\gamma)$ must be positive-definite.
We used the ```R``` function ```mvrnorm``` to generate sequences of (un)correlated variates *E* that we converted to germination rates in the 0-1 range: $\gamma = e^E / \left(1 + e^E \right)$.

#### Implementing Relative Nonlinearity
In the absence of environmental fluctuations, the outcome of competition between two species limited by the same resource is determined by the shape of their resource uptake curves.
That is, at constant resource supply, whichever species has the lowest resource requirement at equilibrium ($R^*$) will exclude all other species [@Tilman1982].
Resource fluctuations create opportunities for species coexistence because the resource level will sometimes exceed the $R^*$ of the superior competitor.
If the resource uptake curves of each species are relatively nonlinear, then some species will be able to take advantage of resource levels that other species cannot [@Chesson1994].

For example, in Fig. 1C we show uptake curves of two species with different degrees of nonlinearity.
Species B has the lowest $R^*$ and would competitively exclude species A in the absence of environmental fluctuations.
But fluctuating resource supplies can benefit species A because it can take advantage of relatively high resource levels due its higher saturation point.
Stable coexistence is only possible, however, if when each species is dominant it improves conditions for its competitor.
This occurs in our model because when a resource conservative species (e.g., species B in Fig. 1C) is abundant, it will draw resources down slowly after a pulse, and its competitor can take advantage of that period of high resource availability.
Likewise, when a resource acquisitive species (e.g., species A in Fig. 1C) is abundant, after a pulse it quickly draws down resources to levels that favor resource conservative species.
Such reciprocity helps each species to increase when rare, stabilizing coexistence [@Armstrong1980; @Chesson2000; @Chesson2004].

### Numerical simulations
To explore how fluctuation-dependent coexistence can affect the diversity-variability relationship, we simulated the model with four species under two scenarios for each coexistence mechanism.
First, we allowed the variance of the environment to determine how many species can coexist, akin to a community assembly experiment with a species pool of four species.
To do this, we simulated communities with all species initially present across a gradient of annual resource variability (for relative nonlinearity) or environmental cue variability (for the storage effect).
Second, we chose parameter values that allowed coexistence of all four species and then performed species removals, akin to a biodiversity-ecosystem function experiment.
The two simulation experiments correspond to (i) sampling ecosystem function across a natural gradient of species richness and (ii) sampling ecosystem function across diversity treatments within a site.

To understand how increasing environmental variability will impact ecosystem variability when coexistence is fluctuation-dependent, we simulated the model over a range of species pool sizes and environmental cue or resource variability.
For each size of species pool (1, 2, 3, or 4 species), we simulated the model at 15 evenly-spaced levels of environmental cue (range = 0.1,2) for the storage effect and 25 evenly-spaced levels of resource variability (range = 0.1,1.4) for relative nonlinearity.
We also explored the influence of asymmetries in species' competitive abilities and correlations in species' environmental responses within the storage effect model.

Under relative nonlinearity, species' resource response curves (Fig. S1-1) reflect traits that determine the temporal variability of each species' population growth.
"Stable" species achieve maximum resource uptake at low resource levels, but their maximum uptake rates are modest. 
For these species, population responses to resource fluctuations are buffered.
"Unstable" species have very high maximum uptake rates, which they only achieve when resource availability is high, leading to large population fluctuations.
The difference in the intrinsic stability of these two kinds of species makes our simulations sensitive to initial conditions.
Therefore, we ran two sets of simulations for relative nonlinearity: beginning with either stable or unstable species as a reference point
For example, if species A is the most stable species and species D is the least stable, we ran simulations where A then B then C then D were allowed to invade.
We then ran simulations with that order reversed.

All simulations were run for 5,000 growing seasons of 100 days each. 
We averaged biomass over the growing season, and those yearly values were used to calculate total community biomass in each year.
After discarding an initial 500 seasons to reduce transient effects on our results, we calculated the coefficient of variation (*CV*) of summed species biomass through time, which represents ecosystem variability, the inverse of ecosystem stability.
We calculated species richness as the number of species whose average biomass was greater than 1 over the course of the simulation.
Parameter values for specific results are given in figure captions.
Within-season dynamics were solved given initial conditions using the package ``deSolve`` [@Soetaert2010] in ```R``` [@Team2013].
```R``` code for our model function is in the Supporting Information Appendix S1.
All model code has been deposited on Figshare (*link*) and is available on GitHub at http://github.com/atredennick/Coexistence-Stability.


RESULTS
-------
When we allowed the variance of the environment to determine which of four initial species coexisted, similar to a study across a natural diversity gradient, we found a positive relationship between richness and variability (Fig. 2A,C).
This was true for the storage effect, where coexistence is maintained by fluctuating dormant-to-live transition rates ($\gamma$), and for relative nonlinearity, where coexistence is maintained by annual resource pulses.
The relationship is driven by the fact that increasing environmental variability increases the strength of both coexistence mechanisms (Fig. S1-2).
More variable conditions promoted species richness, creating a positive relationship between diversity and variability.

When we performed species removals but held environmental variability at a level that allows coexistence of all four species, similar to a biodiversity-ecosystem functioning experiment, we found a negative diversity-variability relationship (Fig. 2B,D).
Scatter around the relationship was small for the storage effect because all species have similar temporal variances.
Regardless of species identity, the presence of more species always stabilized ecosystem functioning through portfolio effects.
In contrast, scatter around the relationship was larger for relative nonlinearity (Fig. 2D) because species with different resource uptake curves had different population variances.
Depending on which species were present, two-species communities were sometimes less variable than three-species communities.

To understand how much species additions can stabilize ecosystem functioning as environmental variability increases, we simulated our model over a range of environmental variance and species pool sizes.
Realized species richness increased with environmental variability and, in some cases, increases in richness completely offset the effect of increasing environmental variability on ecosystem variability.
More species rich communities were less variable on average and increased in ecosystem *CV* at a slower rate than communities with fewer species (e.g., lower slopes in log-log space; Fig. S1-3). 

The dampening effect of fluctuation-dependent coexistence on increasing environmental variability depends on the specific traits (parameter values) of the species in the regional pool.
Moderate competition makes it more difficult for new species to enter the local community, but once they do enter, variability is similar between communities with low and moderate competition (Fig. 3; compare top and bottom panels).
Moderate competition does increase the rate at which ecosystem *CV* increases with environmental variance (Fig. S1-3) because the abundance of inferior competitors is reduced and they do not influence ecosystem *CV* as much as when competition is low.
The correlation of species' environmental responses also mediates the relationship between environmental variance, species richness, and ecosystem *CV*: lower correlations make it easier for new species to enter the community and contribute to porfolio effects (Fig. 3).

In communities where species coexist via relative nonlinearity, the extent to which species additions buffer ecosystem stability against increases in environmental variability depends on the species traits of immigrating species and the order in which they enter the community.
When additional species, which immigrate from the regional pool, are less intrinsically stable than the resident species, ecosystem variability increases at a constant rate even as species are added (Fig. 4A).
If more stable species colonize, species additions buffer the ecosystem from increasing environmental variability (Fig. 4B).
When only the most unstable (resource acquisitive) species is present, ecosystem variability initially declines as resource variability increases (Fig. 4B) because for this species' monoculture biomass is very low at low average resource levels for this species, inflating the *CV*.

DISCUSSION
----------
Theory developed for biodiversity-ecosystem function experiments emphasizes that increases in species richness should reduce ecosystem variability. 
Consistent with theoretical expectations from models and with results from biodiversity-ecosystem functioning experiments, in which species coexistence is maintained by fluctuation-independent mechanisms, our model of  fluctuation-dependent species coexistence [also see @Chesson2001] produced a negative diversity-variability relationship (Fig. 2B,D).
This agreement is encouraging because species almost certainly coexist by some combination of fluctuation-independent (e.g., resource partitioning) and fluctuation-dependent mechanisms.
By extending theory to communities where species richness is explicitly maintained by temporal variability, we have gained confidence that experimental findings are generalizable to many communities.
In local settings where environmental variability is relatively homogeneous, reductions in the number of species should increase the variability of ecosystem functioning, regardless of how coexistence is maintained.

When we allowed communities to assemble at sites across a gradient of environmental variability, we discovered a positive relationship between species richness and ecosystem variability (Fig. 2A,C).
While surprising when viewed through the lens of biodiversity-ecosystem functioning theory and experimental findings, such a relationship is predicted by theory on coexistence in fluctuating environments.
Environmental variability is a prerequisite for the storage effect and relative nonlinearity to stabilize coexistence [@Chesson2000].
These mechanisms can translate increased variability into higher species richness (Fig. S1-2), but the increase in environmental variability also increases ecosystem variability.

Our results may explain why deviations from the negative diversity-variability relationship often come from observational studies [@Jiang2009].
Observational studies must rely on natural diversity gradients, which do not control for differences in environmental variability among sites.
If species richness depends on environmental variability, it is entirely possible to observe positive diversity-variability relationships.
For example, Sasaki and Lauenroth (2011) found a positive relationship between species richness and the temporal variability of plant abundance in a semi-arid grassland.
Their data came from a six sites that were 6 km apart.
While Sasaki and Lauenroth explained their results in terms of dominant species' effects, it is also possible that each site experienced sufficiently different levels of environmental variability to influence species coexistence.
@DeClerck2006 also found a positive diversity-variability when sampling conifer richness and the variability of productivity across a large spatial gradient in the Sierra Nevada.

While our modeling results show that fluctuation-dependent coexistence can create positive diversity-variability relationships, whether such trends are detected will depend on the particular traits of the species in the community and the relative influence of fluctuation-dependent and fluctuation-independent coexistence mechanisms.
Thus, our results may also help explain observational studies where no relationship between diversity and variability is detected.
For example, @Cusson2015 found no relationship between species richness and variability of abundances in several marine macro-benthic ecosystems.
Many of their focal ecosystems were from highly variable intertidal environments.
If coexistence was at least in part determined by environmental fluctuations, then the confounding effect of variability and species richness could offset or overwhlem any effect of species richness on variability.
Previous theoretical work showed how environmental variation can mask the effect of species diversity on ecosystem productivity when sampling across sites [@Loreau1998].
Our mechanistic model extends that conclusion to ecosystem variability.

Whether coexistence is fluctuation-independent or fluctuation-dependent becomes especially important when we consider how ecosystem variability responds to increasing environmental variability.
In the fluctuation-independent case, species richness is essentially fixed because the niche and fitness differences that determine coexistence are not linked to environmental variability.
Therefore, increasing environmental variability will always increase ecosystem variability by increasing the fluctuations of individual species' abundances.
When coexistence is fluctuation-dependent, however, the outcome is less certain.
By simulating communities with different species pool sizes across a gradient of environmental variability, we showed that species gains due to increasing environmental variability can buffer the direct effect of environmental variability on ecosystem variability (Figs. 3 and 4).
These results lead to two conclusions.

First, when predicting the impacts of increasing environmental variability on ecosystem variability, the mechanism of coexistence matters.
Fluctuation-dependent coexistence can buffer ecosystems from increasing environmental variability by promoting increased species richness.
Whether our theoretical predictions hold in real communities is unknown and requires empirical tests.
Doing so would require manipulating environmental variability in communities where coexistence is known to be fluctuation-dependent, at least in part.
Such data do exist [@Angert2009], and a coupled modeling-experimental approach could determine if our predictions hold true in natural communities.

Second, whether local fluctuation-dependent communities can receive the benefit of additional species depends on a diverse regional species pool.
If the regional pool is not greater in size than the local species pool, than ecosystem variability will increase with environmental variability in a similar manner as in fluctuation-independent communities because species richness will be fixed (Fig. 5A,B).
Metacommunity theory has made clear the importance of rescue effects to avoid species extinctions [@Brown1997; @Leibold2004].
Here, instead of local immigration by a resident species working to rescue a species from extinction, immigration to the local community by a new species rescues ecosystem processes from becoming more variable (Fig. 5C,D).
Thus, our results reinforce the importance of both local and regional biodiversity conservation.
Just as declines in local species richness can destabilize ecosystem functioning [@Tilman2006; @Hector2010; @Hautier2014], species losses at larger spatial scales can also increase ecosystem variability.
@Wang2014 show that regional ecosystem variability depends on regional biodiversity through its effects on beta diversity and, in turn, the asynchrony of functioning in local communities.
Our results show that, when coexistence is fluctuation-dependent, regional biodiversity declines could also affect local ecosystem functioning by limiting local colonization events that could be possible under scenarios of increasing environmental variability (Fig. 5).

<!--
Species coexistence in real ecological communities probably emerges from some combination of fluctuation-independent and fluctuation-dependent mechanisms [@Chesson2000; @Clark2010].
Likewise, environmental conditions in real ecosystems are unlikely to change only in their variability without an associated change in the mean [@Avolio2015].
Therefore, environmental change has the potential to alter the niche and fitness differences among species in multiple ways, some of which were not present in our current analysis.
Mean changes in environmental conditions could reorder competitive hierarchies [@Klanderud2005] and/or alter the availability of niches [@Harpole2016].
Associated changes in ecosystem stability will depend upon the magnitude of environmental change, each species' response to the particular environmental driver, and biotic interactions [@Hallett2014a].
-->


ACKNOWLEDGMENTS
---------------
The National Science Foundation provided funding for this work through a Postdoctoral Research Fellowship in Biology to ATT (DBI-1400370) and a CAREER award to PBA (DEB-1054040).

\newpage{}

TABLE
-----

\begin{table}[!htbp]
\footnotesize
\caption{Default values of model parameters and their descriptions. Parameters that vary depending on the mode and strength of species coexistence or depending on species competitive hierarchies are labeled as ``variable'' in parentheses. The dormant-to-live biomass transition fraction ($\gamma$) is a function of other parameters, so has no default value.}
\begin{tabular}{l l l}
\hline
Parameter & Description & Value \\
\hline
$r$ & maximum per capita growth rate & 0.2 (variable) \\
$a$ & Hill function rate parameter & 2 (variable) \\
$b$ & Hill function curvature parameter & 2.5 (variable) \\
$\epsilon$ & resource-to-biomass conversion efficiency & 0.5 \\
$\alpha$ & allocation fraction of live biomass to dormant biomass & 0.5 (variable) \\
$\gamma$ & dormant-to-live biomass transition fraction & -- \\
$\rho$ & correlation of species' response to the environment & 0 (variable) \\
$\sigma_E$ & variance of the environmental cue & 2 (variable) \\
$\eta$ & dormant biomass mortality rate & 0.1 \\
$\mu(R^+)$ & mean annual resource pulse & 20 \\
$\sigma(R^+)$ & standard deviation of annual resource pulse & 0 (variable) \\
\hline
\end{tabular}
\end{table}

\newpage{}

FIGURES
-------
```{r model_types, cache=FALSE, warning=FALSE, message=FALSE, eval=TRUE, dev="png", fig.height=3, fig.width=5, dpi=300,fig.cap="Resource uptake functions and example time series of (un)correlated germination fractions for the storage effect (A,B) and relative nonlinearity (C,D) formulations of the consumer-resource model. The resource uptake functions for both species are equivalent for the storage effect, but their dormant-to-live transition fractions ($\\gamma$) are uncorrelated in time. The opposite is true for relative nonlinearity: the two species have unique resource uptake functions, but their dormant-to-live transition fractions ($\\gamma$) are perfectly correlated in time."}
library(ggplot2)
library(ggthemes)
library(mvtnorm)
library(gridExtra)
library(viridis)
library(RColorBrewer)

# mytheme <- theme_bw()+
#   theme(panel.grid.major.x = element_blank(), 
#         panel.grid.minor.x = element_blank(),
#         panel.grid.minor.y = element_blank(),
#         panel.grid.major.y = element_blank(),
#         panel.background   = element_rect(fill = "white"),
#         axis.text          = element_text(size=6, color="grey35", family = "Arial Narrow"),
#         axis.title         = element_text(size=8, family = "Arial Narrow", face = "bold"),
#         panel.border       = element_blank(),
#         axis.line.x        = element_line(color="black"),
#         axis.line.y        = element_line(color="black"),
#         strip.background   = element_blank(),
#         strip.text         = element_text(size=8, color="grey35", family = "Arial Narrow"),
#         legend.title       = element_text(size=8, family = "Arial Narrow"),
#         legend.text        = element_text(size=6, color="grey35", family = "Arial Narrow"),
#         legend.key.size    = unit(0.3, "cm"))

mytheme <- theme_few()+
  theme(axis.text          = element_text(size=6, color="grey35"),
        axis.title         = element_text(size=8),
        strip.text         = element_text(size=8, color="grey35"),
        legend.title       = element_text(size=8),
        legend.text        = element_text(size=6, color="grey35"),
        legend.key.size    = unit(0.3, "cm"))


# mycols <- c("#9D6188","#97A861")
# mycols <- c("black", "red")
# mycols <- c("grey35", "steelblue")
# mycols <- viridis(2, end = 0.6)
mycols <- brewer.pal(3, "Set2")

# mytheme <- theme(axis.text=element_text(size=6),
#                  axis.title=element_text(size=8),
#                  legend.text=element_text(size=6),
#                  legend.key.size=unit(0.3, "cm"))

 ##  Resource uptake function (Hill function)
  uptake_R <- function(r, R, alpha, beta){
    return((r*R^alpha) / (beta^alpha + R^alpha))
  }
  # Get "germination" fractions for each year
  getG <- function(sigE, rho, nTime){
    varcov <- matrix(c(sigE, rho*sigE, rho*sigE, sigE), 2, 2)
    e <- rmvnorm(n = nTime, mean = c(0,0), sigma = varcov)
    g <- exp(e) / (1+exp(e))
    return(g)
  }

## STORAGE EFFECT PLOTS
parms <- list(
  r = c(5,5),         # max growth rate for each species
  alpha = c(5,5),     # rate parameter for Hill function 
  beta = c(20,20),    # shape parameter for Hill function
  mN = c(0.5,0.5),    # live biomass loss (mortality) rates 
  mD = c(0.01, 0.01), # dormant biomass loss (mortality) rates
  a = c(0.5,0.5)      # allocation fraction of live biomass to seed bank
)
R <- seq(0,100,1)
out_r <- matrix(ncol=2, nrow=length(R))
alpha <- parms$alpha
beta <- parms$beta
for(i in 1:nrow(out_r)){
  out_r[i,1] <- uptake_R(parms$r[1], R[i], alpha[1], beta[1])
  out_r[i,2] <- uptake_R(parms$r[2], R[i], alpha[2], beta[2])
}
strg_uptake <- data.frame(species=rep(c(1:2), each=nrow(out_r)),
                          resource=rep(R, times=2),
                          uptake=c(out_r[,1], out_r[,2]))
strg_uptake_plot <- ggplot()+
  geom_line(data=strg_uptake, aes(x=resource, y=uptake, color=as.factor(species), linetype=as.factor(species)))+
  theme_few()+
  scale_color_manual(values=mycols, name="", labels=c("Species A", "Species B"))+
  guides(size=FALSE, linetype=FALSE)+
  xlab("Resource")+
  ylab("Resource Uptake Rate")+
  geom_text(aes(x=1,y=5, label="A"), size=2.5)+
  mytheme+
  theme(legend.position=c(0.7,0.35))+
  theme(legend.title=element_text(size=6, face="bold"),
        legend.text=element_text(size=6),
        legend.background = element_blank(),
        legend.key = element_blank())

sigE <- 2   # environmental cue variability
rho <- 0    # environmental cue correlation between species
gVec <- getG(sigE = sigE, rho = rho, nTime = 20)
germ_rate <- data.frame(species=rep(c(1:2),each=20),
                        timestep=rep(c(1:20), times=2),
                        germrate=c(gVec[,1], gVec[,2]))
strg_germ_plot <- ggplot()+
  geom_line(data=germ_rate,aes(x=timestep, y=germrate, color=as.factor(species), linetype=as.factor(species)))+
  theme_few()+
  scale_color_manual(values=mycols, name="Species")+
  guides(size=FALSE, linetype=FALSE, color=FALSE)+
  xlab("Simulation Year")+
  ylab("Germination Fraction")+
  geom_text(aes(x=1,y=1,label="B"), size=2.5)+
  mytheme


## RELATIVE NONLINEARITY PLOTS
parms <- list(
  r = c(5,1),          # max growth rate for each species
  alpha = c(5,2),      # rate parameter for Hill function 
  beta = c(20,2.5),    # shape parameter for Hill function
  mN = c(0.5,0.5),     # live biomass loss (mortality) rates 
  mD = c(0.01, 0.01),  # dormant biomass loss (mortality) rates
  a = c(0.5,0.5)       # allocation fraction of live biomass to seed bank
)
R <- seq(0,100,1)
out_r <- matrix(ncol=2, nrow=length(R))
alpha <- parms$alpha
beta <- parms$beta
for(i in 1:nrow(out_r)){
  out_r[i,1] <- uptake_R(parms$r[1], R[i], alpha[1], beta[1])
  out_r[i,2] <- uptake_R(parms$r[2], R[i], alpha[2], beta[2])
}
reln_uptake <- data.frame(species=rep(c(1:2), each=nrow(out_r)),
                          resource=rep(R, times=2),
                          uptake=c(out_r[,1], out_r[,2]))
reln_uptake_plot <- ggplot()+
  geom_line(data=reln_uptake, aes(x=resource, y=uptake, color=as.factor(species), linetype=as.factor(species)))+
  theme_few()+
  scale_color_manual(values=mycols, name="Species")+
  guides(size=FALSE, linetype=FALSE, color=FALSE)+
  xlab("Resource")+
  ylab("Resource Uptake Rate")+
  geom_text(aes(x=1,y=5,label="C"), size=2.5)+
  mytheme

sigE <- 2   # environmental cue variability
rho <- 1    # environmental cue correlation between species
gVec <- getG(sigE = sigE, rho = rho, nTime = 20)
germ_rate <- data.frame(species=rep(c(1:2),each=20),
                        timestep=rep(c(1:20), times=2),
                        germrate=c(gVec[,1], gVec[,2]))
reln_germ_plot <- ggplot()+
  geom_line(data=germ_rate,aes(x=timestep, y=germrate, color=as.factor(species), linetype=as.factor(species)))+
  theme_few()+
  scale_color_manual(values=mycols, name="Species")+
  guides(size=FALSE, linetype=FALSE, color=FALSE)+
  xlab("Simulation Year")+
  ylab("Germination Fraction")+
  geom_text(aes(x=1,y=1,label="D"), size=2.5)+
  mytheme

g_strg <- grid.arrange(strg_uptake_plot, strg_germ_plot, 
                       reln_uptake_plot, reln_germ_plot,
                       ncol=2, nrow=2)

```



\newpage{}

\begin{figure}[!ht]
  \centering
      \includegraphics[height=5in]{/Users/atredenn/Google_Drive/coexistence-stability_submission/figures/coex_stability_figure1.png}
  \caption{Variability of total community biomass as a function of species richness when coexistence is maintained by the storage effect (A,B) or relative nonlinearity (C,D). Top panels show results from simulations where environmental or resource variance determine the number species that coexist in a community. Bottom panels show results from simulations where environmental or resource variance is fixed at a level that allows coexistence of all four species, but species are removed to manipulate diversity. The left-hand panels represent regional diversity-variability relationships across natural diversity gradients, whereas the right-hand panels represent local diversity-variability relationships.}
\end{figure}

\newpage{}

\begin{figure}[!ht]
  \centering
      \includegraphics[height=5in]{/Users/atredenn/Google_Drive/coexistence-stability_submission/figures/coex_stability_figure2.png}
  \caption{The effect of increasing environmental variability on ecosystem variability when species coexist via the storage effect. Panels (A-C) show simulation results where species have slightly asymmetrical competitive effects, whereas panels (D-F) show results when competition is more asymmetric. Columns show results for different levels of correlations of species' environmental responses, $\rho$. Colored vertical lines show the magnitude of environmental variability at which each level of species richness first occurs.}
\end{figure}

\newpage{}

\begin{figure}[!ht]
  \centering
      \includegraphics[height=2.5in]{/Users/atredenn/Google_Drive/coexistence-stability_submission/figures/coex_stability_figure3.png}
  \caption{The effect of environmental variability on ecosystem variability when species coexist via relative nonlinearity. (A) The species pool increases from one to four species, with the fourth species being most unstable (e.g., resource conservative to resource acquisitive). Increasing environmental variability (the SD of annual resource availability) allows for greater species richness, but species additions do not modulate the effect of environmental variability on ecosystem variability. (B) The species pool increases from one to four species, with the fourth species being most stable (e.g., resource acquisitive to resrouce conservative). In this case, increasing environmental variability allows for greater realized species richness and can temper the effect of environmental variability. In (B), there is limited parameter space under which only three species coexist, which is why a three species community is missing.}
\end{figure}

\newpage{}

\begin{figure}[!ht]
  \centering
      \includegraphics[height=4in]{./components/coexistence_stability_infographic_v2.png}
  \caption{Example of how species additions under increasing environmental variability can buffer ecosystem stability when species coexist via the storage effect. Environmental variability ($\sigma^2_E$) increases linearly with time on the \emph{x}-axis. (A) Time series of species' biomass (colored lines) in a closed community where colonization of new species is prevented and (B) its associated coefficient of variation (Rolling CV; calculated over 100-yr moving window) through time. (C) Time series of species' biomass in an open community where colonization by new species from the regional pool of four species becomes possible as environmental variation increases. The trajectory of total biomass CV in the open community (D) asymptotes at lower variability than in the closed community (B) due to the buffering effect of species richness.}
\end{figure}

\newpage{}




\setlength{\parindent}{0ex}
\singlespacing

REFERENCES
----------
